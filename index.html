<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Klev Studio Staff System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial; background:#f4f4f4; }
.container { width:360px; margin:40px auto; background:#fff; padding:20px; border-radius:6px; box-shadow:0 0 10px rgba(0,0,0,.15); border-top:4px solid #c40000;}
h2,h3 { text-align:center; color:#c40000;}
label { margin-top:10px; display:block; font-size:14px;}
input,select,button { width:100%; padding:10px; margin-top:5px; }
button { border:none; cursor:pointer; }
#loginBtn { background:#c40000; color:#fff; margin-top:15px;}
#logoutBtn { background:#c40000; color:#fff; margin-top:15px;}
#addStaffBtn { background:#444; color:#fff; margin-top:10px;}
.hidden { display:none; }
.staffCard { border:1px solid #ddd; padding:10px; margin-top:10px; border-radius:5px;}
.bar { height:18px; background:#eee; border-radius:10px; overflow:hidden; }
.fill { height:100%; background:#4a90e2; }
small { color:#666; }
</style>
</head>
<body>

<div class="container" id="loginBox">
<h2>Staff Login</h2>
<label>Email</label>
<input id="email">
<label>Password</label>
<input id="password" type="password">
<button id="loginBtn">Login</button>
<p id="msg"></p>
</div>

<div class="container hidden" id="dashboard">
<h2>Dashboard</h2>
<p><b>Logged in:</b> <span id="me"></span></p>
<p><b>Role:</b> <span id="myRole"></span></p>

<h3>Your Quota</h3>
<div class="bar"><div class="fill" id="myBar"></div></div>
<p><span id="myQuota"></span></p>

<div id="manageSection" class="hidden">
<h3>All Staff</h3>
<div id="staffList"></div>

<h3>Add Staff</h3>
<input id="newEmail" placeholder="Email">
<input id="newPass" placeholder="Password">
<select id="newRole">
<option>Moderator</option>
<option>Administrator</option>
<option>Management</option>
<option>Ownership</option>
</select>
<button id="addStaffBtn">Add Staff</button>
</div>

<button id="logoutBtn">Logout</button>
</div>

<script>
const MAX = { Moderator:20, Administrator:30, Management:50, Ownership:999 };
const STORAGE='klev_staff';

function mondayReset(u){
  const now=new Date();
  if(now.getDay()!==1) return;
  const last=new Date(u.lastReset||0);
  if(last.toDateString()!==now.toDateString()){
    u.quota=MAX[u.role];
    u.lastReset=now.toISOString();
  }
}

function loadUsers(){
  return JSON.parse(localStorage.getItem(STORAGE)||'[]');
}
function saveUsers(u){ localStorage.setItem(STORAGE,JSON.stringify(u)); }

if(!localStorage.getItem(STORAGE)){
  saveUsers([
    {email:'ownership@klev.studio',password:'suksbhkds',role:'Ownership',quota:MAX.Ownership},
    {email:'add.login@klev.studio',password:'5Z^9^^Z@XSHkplUFc2dHQZ*7V7',role:'Management',quota:MAX.Management}
  ]);
}

function login(){
  const users=loadUsers();
  const u=users.find(x=>x.email===email.value && x.password===password.value);
  if(!u){ msg.textContent='Wrong login'; return; }
  mondayReset(u);
  sessionStorage.setItem('me',JSON.stringify(u));
  saveUsers(users);
  showDashboard();
}

function showDashboard(){
  loginBox.classList.add('hidden');
  dashboard.classList.remove('hidden');
  const me=JSON.parse(sessionStorage.getItem('me'));
  me.quota=Math.max(0,me.quota);
  document.getElementById('me').textContent=me.email;
  document.getElementById('myRole').textContent=me.role;
  document.getElementById('myQuota').textContent=me.quota;
  document.getElementById('myBar').style.width=(me.quota/MAX[me.role])*100+'%';

  if(me.role==='Management'||me.role==='Ownership'){
    manageSection.classList.remove('hidden');
    renderStaff();
  } else {
    manageSection.classList.add('hidden');
  }
}

function renderStaff(){
  const users=loadUsers();
  staffList.innerHTML='';
  users.forEach(u=>{
    const d=document.createElement('div');
    d.className='staffCard';
    d.innerHTML=`
      <b>${u.email}</b><br>
      Role: ${u.role}<br>
      Quota: ${u.quota}
      <div class="bar"><div class="fill" style="width:${(u.quota/MAX[u.role])*100}%"></div></div>
      <button onclick="changeQuota('${u.email}',1)">+1</button>
      <button onclick="changeQuota('${u.email}',-1)">-1</button>
    `;
    staffList.appendChild(d);
  });
}

window.changeQuota=function(email,delta){
  const users=loadUsers();
  const u=users.find(x=>x.email===email);
  if(!u||u.role==='Ownership') return;
  u.quota=Math.max(0,u.quota+delta);
  saveUsers(users);
  renderStaff();
}

loginBtn.onclick=login;
logoutBtn.onclick=()=>{ sessionStorage.clear(); location.reload(); }

addStaffBtn.onclick=()=>{
  const users=loadUsers();
  users.push({
    email:newEmail.value,
    password:newPass.value,
    role:newRole.value,
    quota:MAX[newRole.value]
  });
  saveUsers(users);
  renderStaff();
  newEmail.value=newPass.value='';
};

if(sessionStorage.getItem('me')) showDashboard();
</script>
</body>
</html>
